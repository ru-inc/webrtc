<!DOCTYPE html><html><head><meta charset="UTF-8"/><title>slitscan - WebRTC Example</title><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"/><style>body,html{height:100%}canvas,video{vertical-align:bottom;opacity:0}.center,canvas{position:absolute}*{margin:0;padding:0;-webkit-user-select:none}html{overflow:auto;background-color:#000}body{overflow:hidden;font-family:'Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3',Meiryo,メイリオ,Osaka,'MS PGothic',arial,helvetica,sans-serif;font-size:12px}canvas{left:0;top:0;z-index:0}.center{color:#CCC;z-index:9999;top:50%;left:50%;-webkit-transform:translateY(-50%) translateX(-50%);transform:translateY(-50%) translateX(-50%);padding:32px;border:1px solid #ccc;display:none}</style></head><body><script>var video;!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.crel=t()}(this,function(){function e(){var o,f=arguments,h=f[0],g=f[1],p=2,y=f.length,m=e[r];if(h=e[s](h)?h:l.createElement(h),1===y)return h;if((!c(g,i)||e[a](g)||v(g))&&(--p,g=null),y-p===1&&c(f[p],"string")&&void 0!==h[d])h[d]=f[p];else for(;y>p;++p)if(o=f[p],null!=o)if(v(o))for(var w=0;w<o.length;++w)u(h,o[w]);else u(h,o);for(var x in g)if(m[x]){var b=m[x];typeof b===t?b(h,g[x]):h[n](b,g[x])}else h[n](x,g[x]);return h}var t="function",i="object",o="nodeType",d="textContent",n="setAttribute",r="attrMap",a="isNode",s="isElement",l=typeof document===i?document:{},c=function(e,t){return typeof e===t},f=typeof Node===t?function(e){return e instanceof Node}:function(e){return e&&c(e,i)&&o in e&&c(e.ownerDocument,i)},h=function(t){return e[a](t)&&1===t[o]},v=function(e){return e instanceof Array},u=function(t,i){e[a](i)||(i=l.createTextNode(i)),t.appendChild(i)};return e[r]={},e[s]=h,e[a]=f,"undefined"!=typeof Proxy&&(e.proxy=new Proxy(e,{get:function(t,i){return!(i in e)&&(e[i]=e.bind(null,i)),e[i]}})),e}),function(){var e=crel("div");void 0==e.innerText&&Object.defineProperty(HTMLElement.prototype,"innerText",{get:function(){return this.textContent},set:function(e){this.textContent=e}})}();var ua=window.navigator.userAgent.toLowerCase(),ios=ua.indexOf("iphone")>0||ua.indexOf("ipad")>0||ua.indexOf("ipod")>0,sp=!!(ios||ua.indexOf("android")>0),safari=ua.indexOf("safari")!==-1&&ua.indexOf("chrome")===-1,description=crel("p",{"class":"center"});crel(document.body,description);var loadedmetadata=!1,defalt={w:0,h:0},current={w:0,h:0},src={w:0,h:0},isReload=!1,frontCamera=!1,buffer=[],medias={audio:!1,video:{}};sp&&(medias.video.facingMode={exact:"environment"});var initialize=function(){frontCamera=!!(!sp||medias.video.facingMode&&medias.video.facingMode.exact&&"user"===medias.video.facingMode.exact),video=crel("video",{autoplay:"",playsinline:""}),ios&&crel(document.body,video),video.addEventListener("loadedmetadata",function(e){if(!loadedmetadata){loadedmetadata=!0,sp?video.videoHeight>video.videoWidth?(defalt.w=video.videoWidth,defalt.h=video.videoHeight):(isReload=!0,defalt.h=video.videoWidth,defalt.w=video.videoHeight):(defalt.w=video.videoWidth,defalt.h=video.videoHeight),src.width=video.videoWidth>>1,src.height=video.videoHeight>>1;for(var t=5,i=crel("canvas",{width:src.width,height:src.height+(t-1)&~(t-1)}),o=i.getContext("2d"),d=src.height/t,n=0;n<d;n++){buffer.push(crel("canvas",{width:src.width,height:src.height}));var r=buffer[n].getContext("2d");r.fillStyle="#000",r.fillRect(0,0,src.width,src.height),r.fill()}frontCamera&&(o.translate(src.width,0),o.scale(-1,1),video.style.cssText="-moz-transform: scale(-1, 1); -webkit-transform: scale(-1, 1); -o-transform: scale(-1, 1); transform: scale(-1, 1); filter: FlipH;"),crel(document.body,i);var a=0,s=!1,l=setInterval(function(e){if(0!==defalt.w||0!==current.w||0!==defalt.h||0!==current.h)if(sp&&defalt.w!=video.videoWidth&&defalt.h!=video.videoHeight)i.style.opacity=video.style.opacity=0,description.innerText="縦向きにしてください",description.style.display="block";else{if(sp){if(isReload===!0)return clearInterval(l),void location.reload();description.style.display="none"}i.style.opacity=video.style.opacity=1;var t={w:document.documentElement.clientWidth,h:document.documentElement.clientHeight};if(t.w!=current.w||t.h!=current.h){current.w=t.w,current.h=t.h;var d=0,n=0;if(t.w-defalt.w>=0&&t.h-defalt.h>=0)i.style.width=video.style.width=defalt.w+"px",i.style.height=video.style.height=defalt.h+"px",d=t.w-defalt.w>>1,n=t.h-defalt.h>>1,i.style.marginLeft=video.style.marginLeft=d+"px",i.style.marginTop=video.style.marginTop=n+"px";else{var r=t.w/defalt.w,c=t.h/defalt.h;if(r<c){i.style.marginLeft=video.style.marginLeft="0px";var f=t.h*r*(1/c)>>0;i.style.width=video.style.width=t.w+"px",i.style.height=video.style.height=f+"px",n=t.h-f>>1,i.style.marginTop=video.style.marginTop=n+"px"}else{i.style.marginTop=video.style.marginTop="0px";var h=t.w*c*(1/r)>>0;i.style.width=video.style.width=h+"px",i.style.height=video.style.height=t.h+"px",d=t.w-h>>1,i.style.marginLeft=video.style.marginLeft=d+"px"}}}o.clearRect(0,0,src.width,src.height);for(var v=src.height/buffer.length,u=0;u<buffer.length;u++){var g=u;o.drawImage(buffer[(g+a)%buffer.length],0,g*v,src.width,v,0,g*v,src.width,v)}buffer[a].getContext("2d").drawImage(video,0,0,video.videoWidth,video.videoHeight,0,0,src.width,src.height),++a>=buffer.length&&(a=0,s=!0)}},1e3/30)}})},noUserMedia=function(){ios?(description.innerText="iOS11 Safariで開いてください",description.style.display="block"):(description.innerText="カメラが必要です",description.style.display="block")},allowUserMedia=function(){description.innerText="カメラを許可してください",description.style.display="block"};safari&&!ios?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?(initialize(),navigator.getUserMedia(medias,function(e){video.srcObject=e},function(e){allowUserMedia()})):noUserMedia()):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(initialize(),navigator.mediaDevices.getUserMedia(medias).then(function(e){video.srcObject=e})["catch"](function(e){allowUserMedia()})):noUserMedia();</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-55075754-4","auto"),ga("send","pageview");</script></body></html>