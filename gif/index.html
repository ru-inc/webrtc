<!DOCTYPE html><html><head><meta charset="UTF-8"/><title>GIF slice - WebRTC Example</title><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"/><style>body,html{height:100%}.box,div#info p{pointer-events:none}*,div#info p{-webkit-user-select:none}#retry,.btn{cursor:pointer}#center,#retry,.gif,div#info p{display:none}#retry,.btn canvas{filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .4))}*{margin:0;padding:0}html{overflow:auto;background-color:#000}body{position:relative;overflow:hidden;font-family:'Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3',Meiryo,メイリオ,Osaka,'MS PGothic',arial,helvetica,sans-serif;font-size:12px;-webkit-tap-highlight-color:transparent}#center,.box,div#info{position:absolute}video{vertical-align:bottom;opacity:0}#center{color:#ccc;z-index:9999;top:50%;left:50%;-webkit-transform:translateY(-50%) translateX(-50%);transform:translateY(-50%) translateX(-50%);padding:32px;border:1px solid #ccc}.box{z-index:242;border:1px solid red;top:0;left:0;width:0;height:0}div#info{font-size:14px;font-weight:700;line-height:32px;height:32px;text-align:center;z-index:1191;top:0}#retry,.btn,.gif{z-index:1192;position:absolute}div#info p{color:#DDD;letter-spacing:0;text-shadow:1px 1px 1px rgba(0,0,0,.4)}#retry{width:64px;height:64px;bottom:0;bottom:7px}.btn{width:74px;height:74px;left:50%;bottom:0;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.gif{top:0;left:0;background:rgba(0,0,0,.1)}iframe[name=google_conversion_frame]{position:absolute;z-index:1;top:0;left:-300px}</style></head><body><script src="jquery.min.js"></script><script src="circle-progress.js"></script><script>var video;!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.crel=t()}(this,function(){function e(){var o,p=arguments,f=p[0],u=p[1],h=2,g=p.length,m=e[a];if(f=e[l](f)?f:r.createElement(f),1===g)return f;if((!c(u,i)||e[s](u)||v(u))&&(--h,u=null),g-h===1&&c(p[h],"string")&&void 0!==f[n])f[n]=p[h];else for(;g>h;++h)if(o=p[h],null!=o)if(v(o))for(var w=0;w<o.length;++w)y(f,o[w]);else y(f,o);for(var x in u)if(m[x]){var b=m[x];typeof b===t?b(f,u[x]):f[d](b,u[x])}else f[d](x,u[x]);return f}var t="function",i="object",o="nodeType",n="textContent",d="setAttribute",a="attrMap",s="isNode",l="isElement",r=typeof document===i?document:{},c=function(e,t){return typeof e===t},p=typeof Node===t?function(e){return e instanceof Node}:function(e){return e&&c(e,i)&&o in e&&c(e.ownerDocument,i)},f=function(t){return e[s](t)&&1===t[o]},v=function(e){return e instanceof Array},y=function(t,i){e[s](i)||(i=r.createTextNode(i)),t.appendChild(i)};return e[a]={},e[l]=f,e[s]=p,"undefined"!=typeof Proxy&&(e.proxy=new Proxy(e,{get:function(t,i){return!(i in e)&&(e[i]=e.bind(null,i)),e[i]}})),e}),function(){var e=crel("div");void 0==e.innerText&&Object.defineProperty(HTMLElement.prototype,"innerText",{get:function(){return this.textContent},set:function(e){this.textContent=e}})}();var ua=window.navigator.userAgent.toLowerCase(),ios=ua.indexOf("iphone")>0||ua.indexOf("ipad")>0||ua.indexOf("ipod")>0,safari=ua.indexOf("safari")!==-1&&ua.indexOf("chrome")===-1,sp=!!(ios||ua.indexOf("android")>0),description=crel("p",{id:"center"});crel(document.body,description);var loadedmetadata=!1,defalt={w:0,h:0},current={w:0,h:0},isReload=!1,isInit=!1,medias={audio:!1,video:{}};sp&&(medias.video.facingMode={exact:"environment"});var initialize=function(){sp?video=crel("video",{autoplay:"",playsinline:""}):(video=crel("video"),video.play()),crel(document.body,video),video.addEventListener("loadedmetadata",function(e){if(!loadedmetadata){loadedmetadata=!0,sp?video.videoHeight>video.videoWidth?(defalt.w=video.videoWidth,defalt.h=video.videoHeight):(isReload=!0,defalt.h=video.videoWidth,defalt.w=video.videoHeight):(defalt.w=video.videoWidth,defalt.h=video.videoHeight);var t=crel("canvas",{width:video.videoWidth,height:video.videoHeight}).getContext("2d"),i=crel("div",{"class":"box"});crel(document.body,i);var o=crel("img",{"class":"gif"});crel(document.body,o);var n="play",d=0,a=0,s=0,l=0,r=0,c=4,p=32,f=74+(c<<1),v=sp?0:f,y=setInterval(function(e){if(0!==defalt.w||0!==current.w||0!==defalt.h||0!==current.h)if(sp&&defalt.w!=video.videoWidth&&defalt.h!=video.videoHeight)video.style.opacity=0,description.innerText="縦向きにしてください",description.style.display="block",i.style.display="none","play"==n?u.style.display="none":(o.style.display="none",h.style.display="none",g.p.style.display="none");else{if(sp&&isReload===!0)return clearInterval(y),void location.reload();sp&&(description.style.display="none",i.style.display="block","play"==n?u.style.display="block":(o.style.display="block",h.style.display="block",g.p.style.display="block")),video.style.opacity=1;var m={w:document.documentElement.clientWidth,h:document.documentElement.clientHeight};if(m.w!=current.w||m.h!=current.h)if(current.w=m.w,current.h=m.h,m.w-defalt.w>=0&&m.h-(defalt.h+v)>=0)a=m.w-defalt.w>>1,s=m.h-v-defalt.h>>1,video.style.marginLeft=a+"px",video.style.marginTop=s+"px",video.style.width=defalt.w+"px",video.style.height=defalt.h+"px",l=defalt.w,r=defalt.h;else{var w=m.w/defalt.w,x=m.h/(defalt.h+v);w<x?(l=m.w,r=m.h*w*(1/(m.h/defalt.h))>>0,a=0,s=m.h-v-r>>1,video.style.marginLeft="0px",video.style.marginTop=s+"px",video.style.width=l+"px",video.style.height=r+"px",l=l,r=r):(l=m.w*x*(1/w)>>0,r=m.h-v,a=m.w-l>>1,s=0,video.style.marginTop=s+"px",video.style.marginLeft=a+"px",video.style.width=l+"px",video.style.height=r+"px",l=l,r=r)}var b=.8*(l>r?r:l);d=r-b-v-p-f>0?r-b-v-p-f>>1:0,i.style.top=s+(r-b>>1)-1-d+"px",i.style.left=a+(l-b>>1)-1+"px",i.style.width=i.style.height=b+"px",o.style.top=s-d+"px",o.style.left=a+"px",o.style.width=o.style.height=b+"px",o.style.paddingLeft=o.style.paddingRight=(l-b>>1)+"px",o.style.paddingTop=(r-b>>1)+"px",o.style.paddingBottom=(r-b>>1)+d+"px",h.style.left=a+(l-b>>1)+"px",h.style.bottom=s+c+"px",u.style.bottom=s+c+"px",sp?r-f-b>>1>p?g.div.style.top=s+(r-b>>1)-1-d+b+((r-f-b>>1)-p>>1)+"px":g.div.style.top=s+(r-b>>1)-1-d+b+"px":r-b>>1>p?g.div.style.top=s+(r-b>>1)-1-d+b+((r-b>>1)-p>>1)+"px":g.div.style.top=s+(r-b>>1)-1-d+b+"px",t.drawImage(video,0,0)}},33),u=crel("div",{"class":"btn"});$(u).circleProgress({value:0,size:74,startAngle:.5*-Math.PI,animation:!0,fill:{color:"#FF0000"},emptyFill:"#DDD"}),crel(document.body,u);var h=crel("img",{id:"retry",src:"retry.svg"});crel(document.body,h);var g={};g.p=crel("p",sp?"画像を長押して保存":"画像をドラッグして保存"),g.div=crel("div",{id:"info",style:"width:100%; text-align:center;"},g.p),crel(document.body,g.div),then=Date.now();var m=0,w=new Worker("worker.js");w.addEventListener("message",function(e){var i=e.data;if("string"==typeof i)o.src=i,$(o).css("display","block");else if("[object Object]"===Object.prototype.toString.call(i)){var a=i.type;if(a&&"append"==a)if(--m>0){var s=Date.now(),l=isInit===!1?500:s-then;then=s,isInit=!0,$(u).circleProgress("value",(13-m)/13),setTimeout(function(){var e=.8*(defalt.w>defalt.h?defalt.h:defalt.w),i=d/r*defalt.h;t.drawImage(video,defalt.w-e>>1,(defalt.h-e>>1)-i,e,e,0,0,256,256);var o=t.getImageData(0,0,256,256);w.postMessage(o,[o.data.buffer])},l>=500?10:500-l)}else $(u).circleProgress("value",1),setTimeout(function(){n="result",$(u).css({display:"none"}),$(u).circleProgress("value",0),$(h).fadeIn("normal"),$(g.p).fadeIn("normal"),w.postMessage({type:"cleanup"})},200)}},!1);var x=function(e){then=Date.now(),isInit=!1,m=13,w.postMessage({type:"setup",wide:256,high:256,duration:.125})},b=function(e){m=0},M=function(e){n="play",o.src="",$(u).css("display","block").fadeIn("fast"),$(o).css("display","none"),$(h).fadeOut("fast",function(){$(this).css({display:"none"})}),$(g.p).fadeOut("fast",function(){$(this).css({display:"none"})})};sp?($(u).on("touchstart",x),$(u).on("touchend",b),$(u).on("touchcancel",b),$(h).on("touchstart",M)):($(u).on("mousedown",x),$(u).on("mouseup",b),$(h).on("mousedown",M))}})},noUserMedia=function(){ios?(description.innerText="iOS11 Safariで開いてください",description.style.display="block"):(description.innerText="カメラが必要です",description.style.display="block")},allowUserMedia=function(){description.innerText="カメラを許可してください",description.style.display="block"};safari&&!ios?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?(initialize(),navigator.getUserMedia(medias,function(e){video.srcObject=e},function(e){allowUserMedia()})):noUserMedia()):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(initialize(),navigator.mediaDevices.getUserMedia(medias).then(function(e){video.srcObject=e})["catch"](function(e){allowUserMedia()})):noUserMedia();</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-55075754-4","auto"),ga("send","pageview");</script><script type="text/javascript">var google_conversion_id=835582216,google_custom_params=window.google_tag_params,google_remarketing_only=!0;</script><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script><noscript><div style="display:inline"><img height="1" width="1" style="border-style:none" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/835582216/?guid=ON&amp;script=0"/></div></noscript></body></html>