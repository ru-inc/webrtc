<!DOCTYPE html><html><head><meta charset="UTF-8"/><title>GIF slice - WebRTC Example</title><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"/><style>body,html{height:100%}.box,div#info p{pointer-events:none}*,div#info p{-webkit-user-select:none}#retry,.btn{cursor:pointer}#center,#retry,.gif,div#info p{display:none}#retry,.btn canvas{filter:drop-shadow(1px 1px 1px rgba(0, 0, 0, .4))}*{margin:0;padding:0}html{overflow:auto;background-color:#000}body{position:relative;overflow:hidden;font-family:'Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3',Meiryo,メイリオ,Osaka,'MS PGothic',arial,helvetica,sans-serif;font-size:12px}#center,.box,div#info{position:absolute}video{vertical-align:bottom;opacity:0}#center{color:#ccc;z-index:9999;top:50%;left:50%;-webkit-transform:translateY(-50%) translateX(-50%);transform:translateY(-50%) translateX(-50%);padding:32px;border:1px solid #ccc}.box{z-index:242;border:1px solid red;top:0;left:0;width:0;height:0}div#info{font-size:14px;line-height:32px;height:32px;text-align:center;z-index:1191;top:0}#retry,.btn,.gif{position:absolute;z-index:1192}div#info p{color:#CCC;letter-spacing:0;text-shadow:1px 1px 1px rgba(0,0,0,.4)}#retry{width:64px;height:64px;bottom:0;bottom:7px}.btn{width:74px;height:74px;left:50%;bottom:0;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.gif{top:0;left:0;background:rgba(0,0,0,.1)}</style></head><body><script src="jquery.min.js"></script><script src="circle-progress.js"></script><script>!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.crel=t()}(this,function(){function e(){var o,p=arguments,y=p[0],u=p[1],h=2,g=p.length,x=e[l];if(y=e[s](y)?y:r.createElement(y),1===g)return y;if((!c(u,i)||e[a](u)||f(u))&&(--h,u=null),g-h===1&&c(p[h],"string")&&void 0!==y[d])y[d]=p[h];else for(;g>h;++h)if(o=p[h],null!=o)if(f(o))for(var m=0;m<o.length;++m)v(y,o[m]);else v(y,o);for(var w in u)if(x[w]){var b=x[w];typeof b===t?b(y,u[w]):y[n](b,u[w])}else y[n](w,u[w]);return y}var t="function",i="object",o="nodeType",d="textContent",n="setAttribute",l="attrMap",a="isNode",s="isElement",r=typeof document===i?document:{},c=function(e,t){return typeof e===t},p=typeof Node===t?function(e){return e instanceof Node}:function(e){return e&&c(e,i)&&o in e&&c(e.ownerDocument,i)},y=function(t){return e[a](t)&&1===t[o]},f=function(e){return e instanceof Array},v=function(t,i){e[a](i)||(i=r.createTextNode(i)),t.appendChild(i)};return e[l]={},e[s]=y,e[a]=p,"undefined"!=typeof Proxy&&(e.proxy=new Proxy(e,{get:function(t,i){return!(i in e)&&(e[i]=e.bind(null,i)),e[i]}})),e}),function(){var e=crel("div");void 0==e.innerText&&Object.defineProperty(HTMLElement.prototype,"innerText",{get:function(){return this.textContent},set:function(e){this.textContent=e}})}();var ua=window.navigator.userAgent.toLowerCase(),ios=ua.indexOf("iphone")>0||ua.indexOf("ipad")>0||ua.indexOf("ipod")>0,sp=!!(ios||ua.indexOf("android")>0),description=crel("p",{id:"center"});crel(document.body,description);var loadedmetadata=!1,defalt={w:0,h:0},current={w:0,h:0},isReload=!1;if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia){var medias={audio:!1,video:{}};sp&&(medias.video.facingMode={exact:"environment"}),sp?video=crel("video",{autoplay:"",playsinline:""}):(video=crel("video",{autoplay:"",playsinline:""}),video.play()),crel(document.body,video),video.addEventListener("loadedmetadata",function(e){if(!loadedmetadata){loadedmetadata=!0,sp?video.videoHeight>video.videoWidth?(defalt.w=video.videoWidth,defalt.h=video.videoHeight):(isReload=!0,defalt.h=video.videoWidth,defalt.w=video.videoHeight):(defalt.w=video.videoWidth,defalt.h=video.videoHeight);var t=crel("canvas",{width:video.videoWidth,height:video.videoHeight}).getContext("2d"),i=crel("div",{"class":"box"});crel(document.body,i);var o=crel("img",{"class":"gif"});crel(document.body,o);var d="play",n=0,l=0,a=0,s=0,r=0,c=4,p=32,y=74+(c<<1),f=sp?0:y,v=setInterval(function(e){if(0!==defalt.w||0!==current.w||0!==defalt.h||0!==current.h)if(sp&&defalt.w!=video.videoWidth&&defalt.h!=video.videoHeight)video.style.opacity=0,description.innerText="縦向きにしてください",description.style.display="block",i.style.display="none","play"==d?u.style.display="none":(o.style.display="none",h.style.display="none",g.p.style.display="none");else{if(sp){if(isReload===!0)return clearInterval(v),void location.reload();description.style.display="none",i.style.display="block","play"==d?u.style.display="block":(o.style.display="block",h.style.display="block",g.p.style.display="block")}video.style.opacity=1;var x={w:document.documentElement.clientWidth,h:document.documentElement.clientHeight};if(x.w!=current.w||x.h!=current.h)if(current.w=x.w,current.h=x.h,x.w-defalt.w>=0&&x.h-(defalt.h+f)>=0)l=x.w-defalt.w>>1,a=x.h-f-defalt.h>>1,video.style.marginLeft=l+"px",video.style.marginTop=a+"px",video.style.width=defalt.w+"px",video.style.height=defalt.h+"px",s=defalt.w,r=defalt.h;else{var m=x.w/defalt.w,w=x.h/(defalt.h+f);m<w?(s=x.w,r=x.h*m*(1/(x.h/defalt.h))>>0,l=0,a=x.h-f-r>>1,video.style.marginLeft="0px",video.style.marginTop=a+"px",video.style.width=s+"px",video.style.height=r+"px",s=s,r=r):(s=x.w*w*(1/m)>>0,r=x.h-f,l=x.w-s>>1,a=0,video.style.marginTop=a+"px",video.style.marginLeft=l+"px",video.style.width=s+"px",video.style.height=r+"px",s=s,r=r)}var b=.8*(s>r?r:s);n=r-b-f-p-y>0?r-b-f-p-y>>1:0,i.style.top=a+(r-b>>1)-1-n+"px",i.style.left=l+(s-b>>1)-1+"px",i.style.width=i.style.height=b+"px",o.style.top=a-n+"px",o.style.left=l+"px",o.style.width=o.style.height=b+"px",o.style.paddingLeft=o.style.paddingRight=(s-b>>1)+"px",o.style.paddingTop=(r-b>>1)+"px",o.style.paddingBottom=(r-b>>1)+n+"px",h.style.left=l+(s-b>>1)+"px",h.style.bottom=a+c+"px",u.style.bottom=a+c+"px",sp?r-b>>1>>1>0?g.div.style.top=a+(r-b>>1>>1)-n+"px":g.div.style.top=a+"px":r-b>>1>32?g.div.style.top=a+((r-b>>1)-32>>1)+"px":g.div.style.top=a+"px",t.drawImage(video,0,0)}},33),u=crel("div",{"class":"btn"});$(u).circleProgress({value:0,size:74,startAngle:.5*-Math.PI,animation:!0,fill:{color:"#FF0000"}}),crel(document.body,u);var h=crel("img",{id:"retry",src:"retry.svg"});crel(document.body,h);var g={};g.p=crel("p",sp?"画像を長押して保存":"画像をドラッグして保存"),g.div=crel("div",{id:"info",style:"width:100%; text-align:center;"},g.p),crel(document.body,g.div),then=Date.now();var x=0,m=new Worker("worker.js");m.addEventListener("message",function(e){var i=e.data;if("string"==typeof i)o.src=i,$(o).css("display","block");else if("[object Object]"===Object.prototype.toString.call(i)){var l=i.type;if(l&&"append"==l)if(--x>0){var a=Date.now(),s=a-then;then=a,$(u).circleProgress("value",(13-x)/13),setTimeout(function(){var e=.8*(defalt.w>defalt.h?defalt.h:defalt.w),i=n/r*defalt.h;t.drawImage(video,defalt.w-e>>1,(defalt.h-e>>1)-i,e,e,0,0,256,256);var o=t.getImageData(0,0,256,256);m.postMessage(o,[o.data.buffer])},s>=500?1:500-s)}else $(u).circleProgress("value",1),d="result",setTimeout(function(){$(u).css("display","none"),$(u).circleProgress("value",0),$(h).css("display","block"),$(g.p).css("display","block"),m.postMessage({type:"cleanup"})},250)}},!1);var w=function(e){then=Date.now(),x=13,m.postMessage({type:"setup",wide:256,high:256,duration:.125})},b=function(e){x=0},k=function(e){d="play",o.src="",$(u).css("display","block"),$(o).css("display","none"),$(h).css("display","none"),$(g.p).css("display","none")};sp?($(u).on("touchstart",w),$(u).on("touchend",b),$(u).on("touchcancel",b),$(h).on("touchstart",k)):($(u).on("mousedown",w),$(u).on("mouseup",b),$(h).on("mousedown",k))}}),navigator.getUserMedia(medias,function(e){video.srcObject=e},function(e){description.innerText="カメラを許可してください",description.style.display="block"})}else ios?(description.innerText="iOS11以降が必要です",description.style.display="block"):(description.innerText="カメラが必要です",description.style.display="block");</script><script type="text/javascript">var google_conversion_id=835582216,google_custom_params=window.google_tag_params,google_remarketing_only=!0;</script><script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script><noscript><div style="display:inline"><img height="1" width="1" style="border-style:none" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/835582216/?guid=ON&amp;script=0"/></div></noscript></body></html>